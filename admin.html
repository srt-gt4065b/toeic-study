<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>âš™ï¸ í† ìµ ê°¤ëŸ¬ê·¸ ê´€ë¦¬ì</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* í—¤ë” */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(102, 126, 234, 0.3);
        }

        .header h1 {
            font-size: 28px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header-actions {
            display: flex;
            gap: 10px;
        }

        /* ë¡œê·¸ì¸ í™”ë©´ */
        .login-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .login-screen.hidden {
            display: none;
        }

        .login-box {
            background: rgba(26, 26, 46, 0.95);
            border: 2px solid #667eea;
            border-radius: 20px;
            padding: 40px;
            width: 100%;
            max-width: 400px;
            text-align: center;
        }

        .login-box h2 {
            font-size: 24px;
            margin-bottom: 30px;
            color: #667eea;
        }

        .login-box .icon {
            font-size: 60px;
            margin-bottom: 20px;
        }

        /* ë²„íŠ¼ */
        .btn {
            padding: 12px 24px;
            font-size: 14px;
            font-weight: bold;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
        }

        .btn-primary { background: linear-gradient(135deg, #667eea, #764ba2); }
        .btn-success { background: linear-gradient(135deg, #4caf50, #8bc34a); }
        .btn-warning { background: linear-gradient(135deg, #ff9800, #ffb74d); }
        .btn-danger { background: linear-gradient(135deg, #f44336, #ff5722); }
        .btn-secondary { background: linear-gradient(135deg, #455a64, #78909c); }
        .btn-small { padding: 8px 16px; font-size: 12px; }
        .btn-full { width: 100%; }

        /* ì…ë ¥ í•„ë“œ */
        .input-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            opacity: 0.9;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #667eea;
            border-radius: 10px;
            background: rgba(0,0,0,0.3);
            color: white;
            font-size: 14px;
            outline: none;
            transition: all 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            border-color: #f093fb;
            box-shadow: 0 0 15px rgba(102, 126, 234, 0.3);
        }

        select option {
            background: #1a1a2e;
            color: white;
        }

        /* íƒ­ ë„¤ë¹„ê²Œì´ì…˜ */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: 12px 25px;
            background: rgba(102, 126, 234, 0.2);
            border: 2px solid rgba(102, 126, 234, 0.5);
            border-radius: 10px;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }

        .tab-btn:hover {
            background: rgba(102, 126, 234, 0.4);
        }

        .tab-btn.active {
            background: #667eea;
            border-color: #667eea;
        }

        /* ì¹´ë“œ */
        .card {
            background: rgba(26, 26, 46, 0.8);
            border: 1px solid rgba(102, 126, 234, 0.3);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
        }

        .card-title {
            font-size: 18px;
            margin-bottom: 20px;
            color: #667eea;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* ê·¸ë¦¬ë“œ */
        .grid-2 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .grid-4 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
        }

        /* í†µê³„ ë°•ìŠ¤ */
        .stat-box {
            background: rgba(102, 126, 234, 0.15);
            border: 1px solid rgba(102, 126, 234, 0.3);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }

        .stat-box .value {
            font-size: 32px;
            font-weight: bold;
            color: #ffd700;
        }

        .stat-box .label {
            font-size: 13px;
            opacity: 0.7;
            margin-top: 5px;
        }

        /* CSV ì—…ë¡œë“œ ì˜ì—­ */
        .upload-area {
            border: 3px dashed rgba(102, 126, 234, 0.5);
            border-radius: 15px;
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 20px;
        }

        .upload-area:hover {
            border-color: #f093fb;
            background: rgba(102, 126, 234, 0.1);
        }

        .upload-area .icon {
            font-size: 50px;
            margin-bottom: 15px;
        }

        .upload-area input[type="file"] {
            display: none;
        }

        /* ë¯¸ë¦¬ë³´ê¸° */
        .preview-box {
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            padding: 15px;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 13px;
            margin-bottom: 20px;
        }

        /* í…Œì´ë¸” */
        .table-container {
            overflow-x: auto;
            max-height: 500px;
            overflow-y: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        th {
            background: rgba(102, 126, 234, 0.3);
            font-weight: bold;
            position: sticky;
            top: 0;
        }

        tr:hover {
            background: rgba(102, 126, 234, 0.1);
        }

        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }

        .badge-level {
            background: rgba(102, 126, 234, 0.3);
            color: #a5b4fc;
        }

        /* ê²€ìƒ‰/í•„í„° ë°” */
        .filter-bar {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-bar input, .filter-bar select {
            width: auto;
            min-width: 150px;
        }

        /* ë‹¨ì–´ ëª©ë¡ ì•„ì´í…œ */
        .word-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .word-item .word {
            font-weight: bold;
            color: #ffd700;
            min-width: 150px;
        }

        .word-item .meaning {
            flex: 1;
            color: #00ff88;
        }

        .word-item .actions {
            display: flex;
            gap: 8px;
        }

        /* ëª¨ë‹¬ */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: #1a1a2e;
            border: 2px solid #667eea;
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-title {
            font-size: 20px;
            margin-bottom: 20px;
            color: #667eea;
        }

        /* ë¡œë”© */
        .loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .loading.show {
            display: flex;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255,255,255,0.2);
            border-top-color: #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ì•Œë¦¼ í† ìŠ¤íŠ¸ */
        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            padding: 15px 25px;
            border-radius: 10px;
            color: white;
            font-weight: bold;
            transform: translateX(400px);
            transition: transform 0.3s;
            z-index: 3000;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast.success { background: #4caf50; }
        .toast.error { background: #f44336; }
        .toast.info { background: #2196f3; }

        /* ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }

            .tabs {
                justify-content: center;
            }

            .filter-bar {
                flex-direction: column;
            }

            .filter-bar input, .filter-bar select {
                width: 100%;
            }
        }

        /* ìŠ¤í¬ë¡¤ë°” */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: rgba(0,0,0,0.3); border-radius: 4px; }
        ::-webkit-scrollbar-thumb { background: #667eea; border-radius: 4px; }

        /* í¬ë§· ì•ˆë‚´ */
        .format-guide {
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 13px;
        }

        .format-guide code {
            color: #00ff88;
            background: rgba(0,255,136,0.1);
            padding: 2px 6px;
            border-radius: 4px;
        }

        /* ë‹¨ì–´ ì¶”ê°€ í¼ */
        .add-word-form {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .add-word-form input {
            flex: 1;
            min-width: 150px;
        }

        /* í˜ì´ì§€ ì„¹ì…˜ */
        .section {
            display: none;
        }

        .section.active {
            display: block;
        }
    </style>
</head>
<body>
    <!-- ë¡œë”© -->
    <div class="loading" id="loading">
        <div class="spinner"></div>
    </div>

    <!-- í† ìŠ¤íŠ¸ ì•Œë¦¼ -->
    <div class="toast" id="toast"></div>

    <!-- ë¡œê·¸ì¸ í™”ë©´ -->
    <div class="login-screen" id="loginScreen">
        <div class="login-box">
            <div class="icon">âš™ï¸</div>
            <h2>ê´€ë¦¬ì ë¡œê·¸ì¸</h2>
            <div class="input-group">
                <label>ë¹„ë°€ë²ˆí˜¸</label>
                <input type="password" id="adminPassword" placeholder="ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ ì…ë ¥" onkeypress="if(event.key==='Enter') adminLogin()">
            </div>
            <button class="btn btn-primary btn-full" onclick="adminLogin()">ë¡œê·¸ì¸</button>
            <p style="margin-top:20px; font-size:12px; opacity:0.5;">
                <a href="index.html" style="color:#667eea;">â† ê²Œì„ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
            </p>
        </div>
    </div>

    <!-- ë©”ì¸ ì»¨í…Œì´ë„ˆ -->
    <div class="container" id="mainContainer" style="display:none;">
        <!-- í—¤ë” -->
        <div class="header">
            <h1>âš™ï¸ í† ìµ ê°¤ëŸ¬ê·¸ ê´€ë¦¬ì</h1>
            <div class="header-actions">
                <button class="btn btn-secondary btn-small" onclick="location.href='index.html'">ğŸ® ê²Œì„ìœ¼ë¡œ</button>
                <button class="btn btn-danger btn-small" onclick="adminLogout()">ğŸšª ë¡œê·¸ì•„ì›ƒ</button>
            </div>
        </div>

        <!-- íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
        <div class="tabs">
            <button class="tab-btn active" onclick="showSection('dashboard')">ğŸ“Š ëŒ€ì‹œë³´ë“œ</button>
            <button class="tab-btn" onclick="showSection('words')">ğŸ“š ë‹¨ì–´ ê´€ë¦¬</button>
            <button class="tab-btn" onclick="showSection('upload')">ğŸ“¤ CSV ì—…ë¡œë“œ</button>
            <button class="tab-btn" onclick="showSection('scores')">ğŸ† ì ìˆ˜ ê´€ë¦¬</button>
            <button class="tab-btn" onclick="showSection('students')">ğŸ‘¥ í•™ìƒ í˜„í™©</button>
        </div>

        <!-- ëŒ€ì‹œë³´ë“œ ì„¹ì…˜ -->
        <div class="section active" id="section-dashboard">
            <div class="grid-2">
                <!-- ë‹¨ì–´ í†µê³„ -->
                <div class="card">
                    <div class="card-title">ğŸ“š ë ˆë²¨ë³„ ë‹¨ì–´ í˜„í™©</div>
                    <div class="grid-4" id="wordStats">
                        <!-- ë™ì  ë¡œë“œ -->
                    </div>
                </div>

                <!-- ê²Œì„ í†µê³„ -->
                <div class="card">
                    <div class="card-title">ğŸ® ê²Œì„ í†µê³„</div>
                    <div class="grid-4">
                        <div class="stat-box">
                            <div class="value" id="totalPlayers">0</div>
                            <div class="label">ì´ í”Œë ˆì´ì–´</div>
                        </div>
                        <div class="stat-box">
                            <div class="value" id="totalGames">0</div>
                            <div class="label">ì´ ê²Œì„ ìˆ˜</div>
                        </div>
                        <div class="stat-box">
                            <div class="value" id="avgScore">0</div>
                            <div class="label">í‰ê·  ì ìˆ˜</div>
                        </div>
                        <div class="stat-box">
                            <div class="value" id="todayGames">0</div>
                            <div class="label">ì˜¤ëŠ˜ ê²Œì„</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ìµœê·¼ ê²Œì„ ê¸°ë¡ -->
            <div class="card">
                <div class="card-title">ğŸ• ìµœê·¼ ê²Œì„ ê¸°ë¡</div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>ì‹œê°„</th>
                                <th>í•™ë²ˆ</th>
                                <th>ì´ë¦„</th>
                                <th>ë ˆë²¨</th>
                                <th>ì ìˆ˜</th>
                                <th>ì •ë‹µë¥ </th>
                            </tr>
                        </thead>
                        <tbody id="recentGames">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- ë‹¨ì–´ ê´€ë¦¬ ì„¹ì…˜ -->
        <div class="section" id="section-words">
            <div class="card">
                <div class="card-title">ğŸ“š ë‹¨ì–´ ê´€ë¦¬</div>
                
                <!-- ë ˆë²¨ ì„ íƒ -->
                <div class="filter-bar">
                    <select id="wordLevelSelect" onchange="loadWords()">
                        <option value="300">í† ìµ 300ì  ëª©í‘œ</option>
                        <option value="400">í† ìµ 400ì  ëª©í‘œ</option>
                        <option value="500">í† ìµ 500ì  ëª©í‘œ</option>
                        <option value="600" selected>í† ìµ 600ì  ëª©í‘œ</option>
                        <option value="700">í† ìµ 700ì  ëª©í‘œ</option>
                        <option value="800">í† ìµ 800ì  ëª©í‘œ</option>
                        <option value="900">í† ìµ 900ì  ëª©í‘œ</option>
                        <option value="1000">í† ìµ 990ì + ëª©í‘œ</option>
                    </select>
                    <input type="text" id="wordSearch" placeholder="ğŸ” ë‹¨ì–´ ê²€ìƒ‰..." oninput="filterWords()">
                    <span id="wordCount" style="opacity:0.7;">0ê°œ ë‹¨ì–´</span>
                </div>

                <!-- ë‹¨ì–´ ì¶”ê°€ -->
                <div class="add-word-form">
                    <input type="text" id="newWord" placeholder="ì˜ì–´ ë‹¨ì–´">
                    <input type="text" id="newMeaning" placeholder="í•œêµ­ì–´ ëœ»">
                    <button class="btn btn-success" onclick="addWord()">â• ì¶”ê°€</button>
                </div>

                <!-- ë‹¨ì–´ ëª©ë¡ -->
                <div id="wordList" style="max-height:400px; overflow-y:auto;">
                    <!-- ë™ì  ë¡œë“œ -->
                </div>
            </div>
        </div>

        <!-- CSV ì—…ë¡œë“œ ì„¹ì…˜ -->
        <div class="section" id="section-upload">
            <div class="card">
                <div class="card-title">ğŸ“¤ CSV ì¼ê´„ ì—…ë¡œë“œ</div>

                <div class="input-group">
                    <label>ì—…ë¡œë“œí•  ë ˆë²¨ ì„ íƒ</label>
                    <select id="uploadLevelSelect">
                        <option value="300">í† ìµ 300ì  ëª©í‘œ</option>
                        <option value="400">í† ìµ 400ì  ëª©í‘œ</option>
                        <option value="500">í† ìµ 500ì  ëª©í‘œ</option>
                        <option value="600" selected>í† ìµ 600ì  ëª©í‘œ</option>
                        <option value="700">í† ìµ 700ì  ëª©í‘œ</option>
                        <option value="800">í† ìµ 800ì  ëª©í‘œ</option>
                        <option value="900">í† ìµ 900ì  ëª©í‘œ</option>
                        <option value="1000">í† ìµ 990ì + ëª©í‘œ</option>
                    </select>
                </div>

                <div class="format-guide">
                    <strong>ğŸ“‹ CSV íŒŒì¼ í˜•ì‹:</strong><br><br>
                    <code>word,meaning</code><br>
                    <code>abundant,í’ë¶€í•œ</code><br>
                    <code>acquire,íšë“í•˜ë‹¤</code><br>
                    <code>adequate,ì ì ˆí•œ</code><br><br>
                    â€» ì²« ì¤„ í—¤ë”(word,meaning)ëŠ” ìˆì–´ë„ ì—†ì–´ë„ ë©ë‹ˆë‹¤.<br>
                    â€» ì—…ë¡œë“œ ì‹œ í•´ë‹¹ ë ˆë²¨ì˜ ê¸°ì¡´ ë‹¨ì–´ê°€ ëª¨ë‘ êµì²´ë©ë‹ˆë‹¤.
                </div>

                <div class="upload-area" onclick="document.getElementById('csvFile').click()" id="uploadArea">
                    <div class="icon">ğŸ“„</div>
                    <div>CSV íŒŒì¼ì„ í´ë¦­í•˜ì—¬ ì„ íƒ</div>
                    <div style="font-size:12px; opacity:0.6; margin-top:5px;">ë˜ëŠ” ì—¬ê¸°ì— íŒŒì¼ì„ ë“œë˜ê·¸</div>
                    <input type="file" id="csvFile" accept=".csv" onchange="handleCSV(this)">
                </div>

                <div class="preview-box" id="csvPreview" style="display:none;"></div>

                <div style="display:flex; gap:10px;">
                    <button class="btn btn-success" id="uploadBtn" onclick="uploadWords()" disabled>ğŸ“¤ ì—…ë¡œë“œ</button>
                    <button class="btn btn-secondary" onclick="clearUpload()">ğŸ—‘ï¸ ì´ˆê¸°í™”</button>
                </div>
            </div>

            <!-- ìƒ˜í”Œ ë‹¤ìš´ë¡œë“œ -->
            <div class="card">
                <div class="card-title">ğŸ“¥ ìƒ˜í”Œ CSV ë‹¤ìš´ë¡œë“œ</div>
                <p style="margin-bottom:15px; opacity:0.7;">ê° ë ˆë²¨ë³„ ìƒ˜í”Œ CSV íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œí•˜ì—¬ í˜•ì‹ì„ ì°¸ê³ í•˜ì„¸ìš”.</p>
                <button class="btn btn-primary btn-small" onclick="downloadSampleCSV()">ğŸ“¥ ìƒ˜í”Œ CSV ë‹¤ìš´ë¡œë“œ</button>
            </div>
        </div>

        <!-- ì ìˆ˜ ê´€ë¦¬ ì„¹ì…˜ -->
        <div class="section" id="section-scores">
            <div class="card">
                <div class="card-title">ğŸ† ì ìˆ˜ ê¸°ë¡ ê´€ë¦¬</div>

                <div class="filter-bar">
                    <select id="scoreLevelFilter" onchange="loadScores()">
                        <option value="all">ì „ì²´ ë ˆë²¨</option>
                        <option value="300">300ì </option>
                        <option value="400">400ì </option>
                        <option value="500">500ì </option>
                        <option value="600">600ì </option>
                        <option value="700">700ì </option>
                        <option value="800">800ì </option>
                        <option value="900">900ì </option>
                        <option value="1000">990+ì </option>
                    </select>
                    <input type="text" id="scoreSearch" placeholder="ğŸ” í•™ë²ˆ/ì´ë¦„ ê²€ìƒ‰..." oninput="filterScores()">
                    <button class="btn btn-success btn-small" onclick="exportScoresCSV()">ğŸ“¥ CSV ë‚´ë³´ë‚´ê¸°</button>
                    <button class="btn btn-danger btn-small" onclick="confirmDeleteAllScores()">ğŸ—‘ï¸ ì „ì²´ ì‚­ì œ</button>
                </div>

                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>ìˆœìœ„</th>
                                <th>ë‚ ì§œ</th>
                                <th>í•™ë²ˆ</th>
                                <th>ì´ë¦„</th>
                                <th>ë ˆë²¨</th>
                                <th>ì ìˆ˜</th>
                                <th>ì •ë‹µ</th>
                                <th>ì‘ì—…</th>
                            </tr>
                        </thead>
                        <tbody id="scoresTable">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- í•™ìƒ í˜„í™© ì„¹ì…˜ -->
        <div class="section" id="section-students">
            <div class="card">
                <div class="card-title">ğŸ‘¥ í•™ìƒë³„ í˜„í™©</div>

                <div class="filter-bar">
                    <input type="text" id="studentSearch" placeholder="ğŸ” í•™ë²ˆ/ì´ë¦„ ê²€ìƒ‰..." oninput="filterStudents()">
                    <button class="btn btn-success btn-small" onclick="exportStudentsCSV()">ğŸ“¥ CSV ë‚´ë³´ë‚´ê¸°</button>
                </div>

                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>í•™ë²ˆ</th>
                                <th>ì´ë¦„</th>
                                <th>ì´ ê²Œì„</th>
                                <th>ìµœê³  ì ìˆ˜</th>
                                <th>í‰ê·  ì ìˆ˜</th>
                                <th>ìµœê·¼ í”Œë ˆì´</th>
                            </tr>
                        </thead>
                        <tbody id="studentsTable">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- ë‹¨ì–´ ìˆ˜ì • ëª¨ë‹¬ -->
    <div class="modal" id="editWordModal">
        <div class="modal-content">
            <div class="modal-title">âœï¸ ë‹¨ì–´ ìˆ˜ì •</div>
            <input type="hidden" id="editWordKey">
            <div class="input-group">
                <label>ì˜ì–´ ë‹¨ì–´</label>
                <input type="text" id="editWordText">
            </div>
            <div class="input-group">
                <label>í•œêµ­ì–´ ëœ»</label>
                <input type="text" id="editWordMeaning">
            </div>
            <div style="display:flex; gap:10px;">
                <button class="btn btn-success" onclick="saveEditWord()">ğŸ’¾ ì €ì¥</button>
                <button class="btn btn-secondary" onclick="closeModal('editWordModal')">ì·¨ì†Œ</button>
            </div>
        </div>
    </div>

    <script>
        // ========================================
        // Firebase ì„¤ì •
        // ========================================
        const firebaseConfig = {
            apiKey: "AIzaSyA6NONPoeAGHcMLkLwPunduIGqmODUQnAQ",
  authDomain: "toeic-voca-30c67.firebaseapp.com",
  databaseURL: "https://toeic-voca-30c67-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "toeic-voca-30c67",
  storageBucket: "toeic-voca-30c67.firebasestorage.app",
  messagingSenderId: "740332360254",
  appId: "1:740332360254:web:c04edc2988a6e6f63f776f",
  measurementId: "G-9E8HXE4LJ7"
        };

        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // ========================================
        // ì „ì—­ ë³€ìˆ˜
        // ========================================
        const ADMIN_PASSWORD = 'admin1234';
        let currentWords = [];
        let currentScores = [];
        let csvData = [];

        // ========================================
        // ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ
        // ========================================
        function adminLogin() {
            const password = document.getElementById('adminPassword').value;
            if (password === ADMIN_PASSWORD) {
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('mainContainer').style.display = 'block';
                sessionStorage.setItem('adminLoggedIn', 'true');
                loadDashboard();
            } else {
                showToast('ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.', 'error');
            }
        }

        function adminLogout() {
            sessionStorage.removeItem('adminLoggedIn');
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('mainContainer').style.display = 'none';
            document.getElementById('adminPassword').value = '';
        }

        // ì„¸ì…˜ ì²´í¬
        if (sessionStorage.getItem('adminLoggedIn') === 'true') {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('mainContainer').style.display = 'block';
            loadDashboard();
        }

        // ========================================
        // ì„¹ì…˜ ì „í™˜
        // ========================================
        function showSection(sectionName) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(t => t.classList.remove('active'));
            
            document.getElementById('section-' + sectionName).classList.add('active');
            event.target.classList.add('active');

            // ì„¹ì…˜ë³„ ë°ì´í„° ë¡œë“œ
            switch(sectionName) {
                case 'dashboard': loadDashboard(); break;
                case 'words': loadWords(); break;
                case 'scores': loadScores(); break;
                case 'students': loadStudents(); break;
            }
        }

        // ========================================
        // ëŒ€ì‹œë³´ë“œ
        // ========================================
        function loadDashboard() {
            loadWordStats();
            loadGameStats();
            loadRecentGames();
        }

        function loadWordStats() {
            const levels = [300, 400, 500, 600, 700, 800, 900, 1000];
            const container = document.getElementById('wordStats');
            container.innerHTML = '';

            levels.forEach(level => {
                database.ref(`toeic_galaga/words/level${level}`).once('value')
                    .then(snapshot => {
                        const count = snapshot.exists() ? Object.keys(snapshot.val()).length : 0;
                        container.innerHTML += `
                            <div class="stat-box">
                                <div class="value">${count}</div>
                                <div class="label">${level}ì </div>
                            </div>
                        `;
                    });
            });
        }

        function loadGameStats() {
            database.ref('toeic_galaga/scores').once('value')
                .then(snapshot => {
                    if (!snapshot.exists()) {
                        document.getElementById('totalPlayers').textContent = '0';
                        document.getElementById('totalGames').textContent = '0';
                        document.getElementById('avgScore').textContent = '0';
                        document.getElementById('todayGames').textContent = '0';
                        return;
                    }

                    const scores = [];
                    const players = new Set();
                    const today = new Date().toDateString();
                    let todayCount = 0;
                    let totalScore = 0;

                    snapshot.forEach(child => {
                        const data = child.val();
                        scores.push(data);
                        players.add(data.studentId);
                        totalScore += data.score || 0;
                        
                        if (new Date(data.timestamp).toDateString() === today) {
                            todayCount++;
                        }
                    });

                    document.getElementById('totalPlayers').textContent = players.size;
                    document.getElementById('totalGames').textContent = scores.length;
                    document.getElementById('avgScore').textContent = scores.length > 0 ? Math.round(totalScore / scores.length) : 0;
                    document.getElementById('todayGames').textContent = todayCount;
                });
        }

        function loadRecentGames() {
            database.ref('toeic_galaga/scores')
                .orderByChild('timestamp')
                .limitToLast(20)
                .once('value')
                .then(snapshot => {
                    const games = [];
                    snapshot.forEach(child => games.push(child.val()));
                    games.reverse();

                    const tbody = document.getElementById('recentGames');
                    tbody.innerHTML = games.map(g => `
                        <tr>
                            <td>${formatDate(g.timestamp)}</td>
                            <td>${g.studentId}</td>
                            <td>${g.playerName}</td>
                            <td><span class="badge badge-level">${g.level}ì </span></td>
                            <td style="color:#ffd700; font-weight:bold;">${g.score}</td>
                            <td>${g.correct}/${g.total}</td>
                        </tr>
                    `).join('');
                });
        }

        // ========================================
        // ë‹¨ì–´ ê´€ë¦¬
        // ========================================
        function loadWords() {
            const level = document.getElementById('wordLevelSelect').value;
            showLoading(true);

            database.ref(`toeic_galaga/words/level${level}`).once('value')
                .then(snapshot => {
                    currentWords = [];
                    if (snapshot.exists()) {
                        snapshot.forEach(child => {
                            currentWords.push({
                                key: child.key,
                                ...child.val()
                            });
                        });
                    }
                    renderWords();
                    showLoading(false);
                })
                .catch(err => {
                    showToast('ë‹¨ì–´ ë¡œë“œ ì‹¤íŒ¨: ' + err.message, 'error');
                    showLoading(false);
                });
        }

        function renderWords() {
            const search = document.getElementById('wordSearch').value.toLowerCase();
            const filtered = currentWords.filter(w => 
                w.word.toLowerCase().includes(search) || 
                w.meaning.toLowerCase().includes(search)
            );

            document.getElementById('wordCount').textContent = `${filtered.length}ê°œ ë‹¨ì–´`;

            const container = document.getElementById('wordList');
            container.innerHTML = filtered.map(w => `
                <div class="word-item">
                    <span class="word">${w.word}</span>
                    <span class="meaning">${w.meaning}</span>
                    <div class="actions">
                        <button class="btn btn-warning btn-small" onclick="editWord('${w.key}', '${w.word}', '${w.meaning}')">âœï¸</button>
                        <button class="btn btn-danger btn-small" onclick="deleteWord('${w.key}')">ğŸ—‘ï¸</button>
                    </div>
                </div>
            `).join('');
        }

        function filterWords() {
            renderWords();
        }

        function addWord() {
            const word = document.getElementById('newWord').value.trim();
            const meaning = document.getElementById('newMeaning').value.trim();
            const level = document.getElementById('wordLevelSelect').value;

            if (!word || !meaning) {
                showToast('ë‹¨ì–´ì™€ ëœ»ì„ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”.', 'error');
                return;
            }

            showLoading(true);

            database.ref(`toeic_galaga/words/level${level}`).push({ word, meaning })
                .then(() => {
                    showToast('ë‹¨ì–´ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                    document.getElementById('newWord').value = '';
                    document.getElementById('newMeaning').value = '';
                    loadWords();
                })
                .catch(err => {
                    showToast('ì¶”ê°€ ì‹¤íŒ¨: ' + err.message, 'error');
                    showLoading(false);
                });
        }

        function editWord(key, word, meaning) {
            document.getElementById('editWordKey').value = key;
            document.getElementById('editWordText').value = word;
            document.getElementById('editWordMeaning').value = meaning;
            document.getElementById('editWordModal').classList.add('show');
        }

        function saveEditWord() {
            const key = document.getElementById('editWordKey').value;
            const word = document.getElementById('editWordText').value.trim();
            const meaning = document.getElementById('editWordMeaning').value.trim();
            const level = document.getElementById('wordLevelSelect').value;

            if (!word || !meaning) {
                showToast('ë‹¨ì–´ì™€ ëœ»ì„ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”.', 'error');
                return;
            }

            showLoading(true);
            closeModal('editWordModal');

            database.ref(`toeic_galaga/words/level${level}/${key}`).update({ word, meaning })
                .then(() => {
                    showToast('ë‹¨ì–´ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                    loadWords();
                })
                .catch(err => {
                    showToast('ìˆ˜ì • ì‹¤íŒ¨: ' + err.message, 'error');
                    showLoading(false);
                });
        }

        function deleteWord(key) {
            if (!confirm('ì´ ë‹¨ì–´ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

            const level = document.getElementById('wordLevelSelect').value;
            showLoading(true);

            database.ref(`toeic_galaga/words/level${level}/${key}`).remove()
                .then(() => {
                    showToast('ë‹¨ì–´ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                    loadWords();
                })
                .catch(err => {
                    showToast('ì‚­ì œ ì‹¤íŒ¨: ' + err.message, 'error');
                    showLoading(false);
                });
        }

        // ========================================
        // CSV ì—…ë¡œë“œ
        // ========================================
        function handleCSV(input) {
            const file = input.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                parseCSV(e.target.result);
            };
            reader.readAsText(file);
        }

        function parseCSV(text) {
            const lines = text.split('\n').filter(line => line.trim());
            csvData = [];

            const firstLine = lines[0].toLowerCase();
            const startIndex = (firstLine.includes('word') || firstLine.includes('meaning')) ? 1 : 0;

            for (let i = startIndex; i < lines.length; i++) {
                const parts = lines[i].split(',').map(p => p.trim().replace(/^["']|["']$/g, ''));
                if (parts.length >= 2 && parts[0] && parts[1]) {
                    csvData.push({ word: parts[0], meaning: parts[1] });
                }
            }

            const preview = document.getElementById('csvPreview');
            if (csvData.length > 0) {
                preview.style.display = 'block';
                preview.innerHTML = `<strong style="color:#00ff88;">âœ… ì´ ${csvData.length}ê°œ ë‹¨ì–´ ì¸ì‹</strong><br><br>` +
                    csvData.slice(0, 15).map((w, i) => `${i+1}. ${w.word} â†’ ${w.meaning}`).join('<br>') +
                    (csvData.length > 15 ? '<br>...' : '');
                document.getElementById('uploadBtn').disabled = false;
            } else {
                preview.style.display = 'block';
                preview.innerHTML = '<span style="color:#ff6b6b;">âŒ ìœ íš¨í•œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</span>';
                document.getElementById('uploadBtn').disabled = true;
            }
        }

        function uploadWords() {
            if (csvData.length === 0) return;

            const level = document.getElementById('uploadLevelSelect').value;

            if (!confirm(`ë ˆë²¨ ${level}ì— ${csvData.length}ê°œ ë‹¨ì–´ë¥¼ ì—…ë¡œë“œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nâš ï¸ ê¸°ì¡´ ë‹¨ì–´ê°€ ëª¨ë‘ ëŒ€ì²´ë©ë‹ˆë‹¤!`)) {
                return;
            }

            showLoading(true);

            const updates = {};
            csvData.forEach((word, index) => {
                updates[`word_${index}`] = word;
            });

            database.ref(`toeic_galaga/words/level${level}`).set(updates)
                .then(() => {
                    showLoading(false);
                    showToast(`${csvData.length}ê°œ ë‹¨ì–´ê°€ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!`, 'success');
                    clearUpload();
                    loadWordStats();
                })
                .catch(err => {
                    showLoading(false);
                    showToast('ì—…ë¡œë“œ ì‹¤íŒ¨: ' + err.message, 'error');
                });
        }

        function clearUpload() {
            csvData = [];
            document.getElementById('csvPreview').style.display = 'none';
            document.getElementById('csvFile').value = '';
            document.getElementById('uploadBtn').disabled = true;
        }

        function downloadSampleCSV() {
            const sample = 'word,meaning\nabundant,í’ë¶€í•œ\nacquire,íšë“í•˜ë‹¤\nadequate,ì ì ˆí•œ\naccomplish,ì„±ì·¨í•˜ë‹¤\nanticipate,ì˜ˆìƒí•˜ë‹¤';
            const blob = new Blob(['\uFEFF' + sample], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'toeic_words_sample.csv';
            link.click();
        }

        // ë“œë˜ê·¸ ì•¤ ë“œë¡­
        const uploadArea = document.getElementById('uploadArea');
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.style.borderColor = '#f093fb';
            uploadArea.style.background = 'rgba(102, 126, 234, 0.2)';
        });
        uploadArea.addEventListener('dragleave', () => {
            uploadArea.style.borderColor = 'rgba(102, 126, 234, 0.5)';
            uploadArea.style.background = 'transparent';
        });
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.style.borderColor = 'rgba(102, 126, 234, 0.5)';
            uploadArea.style.background = 'transparent';
            
            const file = e.dataTransfer.files[0];
            if (file && file.name.endsWith('.csv')) {
                const reader = new FileReader();
                reader.onload = (e) => parseCSV(e.target.result);
                reader.readAsText(file);
            } else {
                showToast('CSV íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.', 'error');
            }
        });

        // ========================================
        // ì ìˆ˜ ê´€ë¦¬
        // ========================================
        function loadScores() {
            showLoading(true);

            database.ref('toeic_galaga/scores')
                .orderByChild('score')
                .once('value')
                .then(snapshot => {
                    currentScores = [];
                    snapshot.forEach(child => {
                        currentScores.push({ key: child.key, ...child.val() });
                    });
                    currentScores.reverse();
                    renderScores();
                    showLoading(false);
                })
                .catch(err => {
                    showToast('ì ìˆ˜ ë¡œë“œ ì‹¤íŒ¨: ' + err.message, 'error');
                    showLoading(false);
                });
        }

        function renderScores() {
            const levelFilter = document.getElementById('scoreLevelFilter').value;
            const search = document.getElementById('scoreSearch').value.toLowerCase();

            let filtered = currentScores;
            
            if (levelFilter !== 'all') {
                filtered = filtered.filter(s => s.level == levelFilter);
            }
            
            if (search) {
                filtered = filtered.filter(s => 
                    s.studentId.toLowerCase().includes(search) ||
                    s.playerName.toLowerCase().includes(search)
                );
            }

            const tbody = document.getElementById('scoresTable');
            tbody.innerHTML = filtered.slice(0, 100).map((s, i) => `
                <tr>
                    <td>${i + 1}</td>
                    <td>${formatDate(s.timestamp)}</td>
                    <td>${s.studentId}</td>
                    <td>${s.playerName}</td>
                    <td><span class="badge badge-level">${s.level}ì </span></td>
                    <td style="color:#ffd700; font-weight:bold;">${s.score}</td>
                    <td>${s.correct}/${s.total}</td>
                    <td>
                        <button class="btn btn-danger btn-small" onclick="deleteScore('${s.key}')">ğŸ—‘ï¸</button>
                    </td>
                </tr>
            `).join('');
        }

        function filterScores() {
            renderScores();
        }

        function deleteScore(key) {
            if (!confirm('ì´ ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

            showLoading(true);
            database.ref(`toeic_galaga/scores/${key}`).remove()
                .then(() => {
                    showToast('ê¸°ë¡ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                    loadScores();
                })
                .catch(err => {
                    showToast('ì‚­ì œ ì‹¤íŒ¨: ' + err.message, 'error');
                    showLoading(false);
                });
        }

        function confirmDeleteAllScores() {
            if (!confirm('âš ï¸ ì •ë§ë¡œ ëª¨ë“  ì ìˆ˜ ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!')) return;
            if (!confirm('ì •ë§ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ë§ˆì§€ë§‰ í™•ì¸ì…ë‹ˆë‹¤.')) return;

            showLoading(true);
            database.ref('toeic_galaga/scores').remove()
                .then(() => {
                    showToast('ëª¨ë“  ê¸°ë¡ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                    loadScores();
                    loadDashboard();
                })
                .catch(err => {
                    showToast('ì‚­ì œ ì‹¤íŒ¨: ' + err.message, 'error');
                    showLoading(false);
                });
        }

        function exportScoresCSV() {
            if (currentScores.length === 0) {
                showToast('ë‚´ë³´ë‚¼ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.', 'error');
                return;
            }

            const headers = ['ìˆœìœ„', 'ë‚ ì§œ', 'í•™ë²ˆ', 'ì´ë¦„', 'ë ˆë²¨', 'ì ìˆ˜', 'ì •ë‹µ', 'ì´ë¬¸ì œ'];
            const rows = currentScores.map((s, i) => [
                i + 1,
                formatDate(s.timestamp),
                s.studentId,
                s.playerName,
                s.level,
                s.score,
                s.correct,
                s.total
            ]);

            const csv = [headers, ...rows].map(row => row.join(',')).join('\n');
            downloadCSV(csv, `toeic_galaga_scores_${formatDateFile()}.csv`);
        }

        // ========================================
        // í•™ìƒ í˜„í™©
        // ========================================
        function loadStudents() {
            showLoading(true);

            database.ref('toeic_galaga/scores').once('value')
                .then(snapshot => {
                    const students = {};

                    snapshot.forEach(child => {
                        const data = child.val();
                        const id = data.studentId;

                        if (!students[id]) {
                            students[id] = {
                                studentId: id,
                                playerName: data.playerName,
                                games: 0,
                                totalScore: 0,
                                maxScore: 0,
                                lastPlay: 0
                            };
                        }

                        students[id].games++;
                        students[id].totalScore += data.score || 0;
                        students[id].maxScore = Math.max(students[id].maxScore, data.score || 0);
                        students[id].lastPlay = Math.max(students[id].lastPlay, data.timestamp || 0);
                    });

                    renderStudents(Object.values(students));
                    showLoading(false);
                })
                .catch(err => {
                    showToast('í•™ìƒ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨: ' + err.message, 'error');
                    showLoading(false);
                });
        }

        function renderStudents(students) {
            const search = document.getElementById('studentSearch').value.toLowerCase();
            
            let filtered = students;
            if (search) {
                filtered = students.filter(s => 
                    s.studentId.toLowerCase().includes(search) ||
                    s.playerName.toLowerCase().includes(search)
                );
            }

            // ê²Œì„ ìˆ˜ ê¸°ì¤€ ì •ë ¬
            filtered.sort((a, b) => b.games - a.games);

            const tbody = document.getElementById('studentsTable');
            tbody.innerHTML = filtered.map(s => `
                <tr>
                    <td>${s.studentId}</td>
                    <td>${s.playerName}</td>
                    <td>${s.games}</td>
                    <td style="color:#ffd700; font-weight:bold;">${s.maxScore}</td>
                    <td>${Math.round(s.totalScore / s.games)}</td>
                    <td>${formatDate(s.lastPlay)}</td>
                </tr>
            `).join('');
        }

        function filterStudents() {
            loadStudents();
        }

        function exportStudentsCSV() {
            // í…Œì´ë¸”ì—ì„œ ë°ì´í„° ì¶”ì¶œ
            const rows = [];
            document.querySelectorAll('#studentsTable tr').forEach(tr => {
                const cells = tr.querySelectorAll('td');
                if (cells.length > 0) {
                    rows.push([
                        cells[0].textContent,
                        cells[1].textContent,
                        cells[2].textContent,
                        cells[3].textContent,
                        cells[4].textContent,
                        cells[5].textContent
                    ]);
                }
            });

            if (rows.length === 0) {
                showToast('ë‚´ë³´ë‚¼ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.', 'error');
                return;
            }

            const headers = ['í•™ë²ˆ', 'ì´ë¦„', 'ì´ê²Œì„', 'ìµœê³ ì ìˆ˜', 'í‰ê· ì ìˆ˜', 'ìµœê·¼í”Œë ˆì´'];
            const csv = [headers, ...rows].map(row => row.join(',')).join('\n');
            downloadCSV(csv, `toeic_galaga_students_${formatDateFile()}.csv`);
        }

        // ========================================
        // ìœ í‹¸ë¦¬í‹°
        // ========================================
        function showLoading(show) {
            document.getElementById('loading').classList.toggle('show', show);
        }

        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast ${type} show`;
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('show');
        }

        function formatDate(timestamp) {
            if (!timestamp) return '-';
            const d = new Date(timestamp);
            return `${d.getMonth()+1}/${d.getDate()} ${d.getHours()}:${String(d.getMinutes()).padStart(2,'0')}`;
        }

        function formatDateFile() {
            const d = new Date();
            return `${d.getFullYear()}${String(d.getMonth()+1).padStart(2,'0')}${String(d.getDate()).padStart(2,'0')}`;
        }

        function downloadCSV(content, filename) {
            const blob = new Blob(['\uFEFF' + content], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = filename;
            link.click();
        }
    </script>
</body>
</html>
